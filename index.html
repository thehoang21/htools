<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <!-- Viewport fit cover để hỗ trợ các thiết bị tràn viền -->
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HTools</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Google Material Symbols -->
    <!-- Google Material Symbols -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <!-- Docx & FileSaver -->
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <link rel="icon" type="image/png" href="./images/favicon.png">
    <link rel="stylesheet" href="style.css">
</head>

<body class="h-screen overflow-hidden flex bg-slate-50">

    <!-- Mobile Overlay Backdrop -->
    <div id="mobileOverlay" onclick="toggleMobileSidebar()"
        class="fixed inset-0 bg-slate-900/20 backdrop-blur-sm z-40 hidden xl:hidden transition-opacity duration-300">
    </div>

    <!-- CUSTOM CONFIRM MODAL -->
    <div id="resetModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity opacity-0 duration-300"
            id="resetModalBackdrop" onclick="closeResetModal()"></div>
        <div class="relative w-full max-w-[320px] sm:max-w-sm bg-white rounded-2xl shadow-2xl transform scale-95 opacity-0 transition-all duration-200"
            id="resetModalPanel">
            <div class="p-6 text-center">
                <div
                    class="w-14 h-14 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 ring-8 ring-red-50/50">
                    <span class="material-symbols-outlined text-[32px] text-red-500">warning</span>
                </div>
                <h3 class="text-lg font-bold text-slate-800 mb-2">Đặt lại dữ liệu?</h3>
                <p class="text-[13px] sm:text-sm text-slate-500 mb-6 leading-relaxed">
                    Hành động này sẽ xóa toàn bộ cấu hình giờ làm và dữ liệu tính công đã lưu trên trình duyệt này.
                </p>
                <div class="flex gap-3">
                    <button onclick="closeResetModal()"
                        class="flex-1 px-4 py-2.5 bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm font-semibold rounded-xl transition-colors active:scale-95">Hủy
                        bỏ</button>
                    <button onclick="confirmReset()"
                        class="flex-1 px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold rounded-xl shadow-lg shadow-red-200 transition-all active:scale-95">Đồng
                        ý</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SIDEBAR -->
    <!-- Logic: Hidden on mobile/tablet portrait (<1280px), Visible on desktop/tablet landscape (>=1280px) -->
    <aside id="sidebar"
        class="fixed xl:static inset-y-0 left-0 z-50 bg-white border-r border-slate-200 flex flex-col w-64 sidebar-transition transform -translate-x-full xl:translate-x-0 shadow-xl xl:shadow-none h-full">
        <!-- Collapse Button (Desktop Only) -->
        <button onclick="toggleSidebarCollapse()"
            class="hidden xl:flex absolute -right-3 top-1/2 -translate-y-1/2 w-6 h-6 bg-white border border-slate-200 rounded-full items-center justify-center text-slate-400 hover:text-blue-600 hover:border-blue-400 shadow-sm z-50 transition-all focus:outline-none hover:scale-110 active:scale-95">
            <span id="collapseIcon" class="material-symbols-outlined text-[16px]">chevron_left</span>
        </button>

        <div
            class="h-16 flex items-center justify-between px-5 border-b border-slate-100 shrink-0 overflow-hidden whitespace-nowrap bg-white">
            <div class="flex items-center gap-3">
                <div
                    class="w-9 h-9 rounded-xl bg-blue-600 flex items-center justify-center text-white shrink-0 shadow-lg shadow-blue-600/20">
                    <span class="material-symbols-outlined text-[22px]">build</span>
                </div>
                <div class="flex flex-col nav-text">
                    <span class="font-bold text-lg text-slate-800 tracking-tight leading-tight">HTools</span>
                    <span class="text-[10px] font-semibold text-slate-400 uppercase tracking-wider">Phiên bản 1.7</span>
                </div>
            </div>
            <!-- Mobile Close Button -->
            <button onclick="toggleMobileSidebar()" class="xl:hidden p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-50 rounded-lg transition-colors">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>

        <nav class="flex-1 overflow-y-auto py-6 px-3 space-y-2">
            <button onclick="switchTab('calculator')" id="nav-calculator"
                class="nav-item active w-full flex items-center gap-3 px-3 py-3 rounded-lg transition-all text-left group/item relative overflow-hidden">
                <span class="material-symbols-outlined shrink-0">pending_actions</span>
                <span class="nav-text font-medium text-sm">Tính Công</span>
            </button>

            <button onclick="switchTab('salary')" id="nav-salary"
                class="nav-item w-full flex items-center gap-3 px-3 py-3 rounded-lg transition-all text-left group/item relative overflow-hidden">
                <span class="material-symbols-outlined shrink-0">payments</span>
                <span class="nav-text font-medium text-sm">Tính Lương Tháng</span>
            </button>

            <button onclick="switchTab('tax')" id="nav-tax"
                class="nav-item w-full flex items-center gap-3 px-3 py-3 rounded-lg transition-all text-left group/item relative overflow-hidden">
                <span class="material-symbols-outlined shrink-0">calculate</span>
                <span class="nav-text font-medium text-sm">Tính Thuế TNCN</span>
            </button>
        </nav>

        <div class="p-4 border-t border-slate-100 nav-text bg-slate-50/50">
            <div class="flex items-center gap-2 text-xs text-slate-400">
                <span class="material-symbols-outlined text-[14px]">verified_user</span>
                <span>Dữ liệu lưu trên máy bạn</span>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="flex-1 flex flex-col h-screen overflow-hidden w-full bg-slate-50 relative">
        <header
            class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-4 xl:px-8 shrink-0 shadow-sm z-30 relative">
            <div class="flex items-center gap-3">
                <!-- Mobile/Tablet Portrait Menu Button -->
                <button onclick="toggleMobileSidebar()"
                    class="xl:hidden p-2.5 -ml-2 rounded-lg hover:bg-slate-100 text-slate-600 active:bg-slate-200 transition-colors">
                    <span class="material-symbols-outlined">menu</span>
                </button>
                <h2 id="pageTitle"
                    class="text-lg font-bold text-slate-800 tracking-tight truncate max-w-[200px] sm:max-w-none">Tính
                    Công</h2>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-4 xl:p-8 scroll-smooth pb-safe relative">

            <!-- TAB 1: CALCULATOR -->
            <div id="tab-calculator" class="tab-content w-full space-y-5 animate-fade-in pb-4">
                <!-- Info Bar & Reset Button Row -->
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-2">
                    <div
                        class="flex items-center gap-2 text-xs font-medium text-blue-600 bg-white px-4 py-2.5 rounded-lg border border-blue-100 shadow-sm flex-1 w-full sm:w-auto">
                        <span class="material-symbols-outlined text-blue-500 text-sm">info</span>
                        <span>Dữ liệu được tự động lưu. Tính toán tức thì.</span>
                    </div>

                    <button onclick="showResetModal()"
                        class="group text-xs font-semibold flex items-center text-slate-600 hover:text-red-600 transition-colors px-3 py-2.5 border border-slate-200 rounded-lg bg-white hover:bg-red-50 shadow-sm active:scale-95 w-full sm:w-auto justify-center">
                        <span
                            class="material-symbols-outlined text-[18px] mr-1.5 transition-transform group-hover:rotate-180">restart_alt</span>
                        Đặt lại dữ liệu
                    </button>
                </div>

                <!-- Main Grid Layout -->
                <div class="grid grid-cols-1 xl:grid-cols-12 gap-5 xl:gap-8 relative">

                    <!-- Left Column: Inputs -->
                    <div class="xl:col-span-5 space-y-5">
                        <!-- Time Card -->
                        <div class="shadcn-card p-4 sm:p-5 space-y-4">
                            <div class="flex items-center gap-2 mb-1 border-b pb-3 border-slate-50">
                                <div class="p-1.5 bg-blue-50 rounded text-blue-600">
                                    <span class="material-symbols-outlined text-[20px]">schedule</span>
                                </div>
                                <h3 class="font-semibold text-sm text-slate-900 uppercase tracking-wide">Thời gian làm
                                    việc</h3>
                            </div>
                            <!-- Sub-grid for inputs: 1 col on tiny screens, 2 cols on most phones/tablets -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="shadcn-label">Giờ bắt đầu</label>
                                    <input type="time" id="startTime" value="07:30"
                                        class="shadcn-input save-target touch-manipulation" oninput="calculate()">
                                </div>
                                <div>
                                    <label class="shadcn-label">Giờ kết thúc</label>
                                    <input type="time" id="endTime" value="18:00"
                                        class="shadcn-input save-target touch-manipulation" oninput="calculate()">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="shadcn-label">Nghỉ trưa từ</label>
                                    <input type="time" id="breakStart" value="11:30"
                                        class="shadcn-input save-target touch-manipulation" oninput="calculate()">
                                </div>
                                <div>
                                    <label class="shadcn-label">Nghỉ trưa đến</label>
                                    <input type="time" id="breakEnd" value="13:00"
                                        class="shadcn-input save-target touch-manipulation" oninput="calculate()">
                                </div>
                            </div>
                        </div>

                        <!-- Parameters Card -->
                        <div class="shadcn-card p-4 sm:p-5 space-y-4">
                            <div class="flex items-center gap-2 mb-1 border-b pb-3 border-slate-50">
                                <div class="p-1.5 bg-blue-50 rounded text-blue-600">
                                    <span class="material-symbols-outlined text-[20px]">tune</span>
                                </div>
                                <h3 class="font-semibold text-sm text-slate-900 uppercase tracking-wide">Thông số tính
                                    toán</h3>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="shadcn-label">Tính OT sau</label>
                                    <input type="time" id="otThreshold" value="17:00"
                                        class="shadcn-input save-target touch-manipulation" oninput="calculate()">
                                </div>
                                <div>
                                    <label class="shadcn-label">Hệ số OT</label>
                                    <input type="number" id="otCoeff" value="1.5" step="0.1"
                                        class="shadcn-input save-target touch-manipulation" oninput="calculate()">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="shadcn-label">Số ngày làm</label>
                                    <input type="number" id="workDays" value="27"
                                        class="shadcn-input save-target touch-manipulation" oninput="calculate()">
                                </div>
                                <div>
                                    <label class="shadcn-label">Giờ chuẩn/ngày</label>
                                    <input type="number" id="standardHours" value="8" readonly
                                        class="shadcn-input bg-slate-50 text-slate-400 cursor-not-allowed border-dashed">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Results -->
                    <div class="xl:col-span-7 space-y-5 xl:sticky xl:top-0 xl:self-start">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <!-- Daily Result -->
                            <div
                                class="shadcn-card p-5 flex flex-col justify-between hover:border-blue-300 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-0.5">
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <span
                                            class="material-symbols-outlined text-blue-500 bg-blue-50 p-1.5 rounded-md">today</span>
                                        <h3 class="text-sm font-semibold text-slate-700">Kết quả 1 Ngày</h3>
                                    </div>
                                    <div
                                        class="text-3xl font-bold tracking-tight text-slate-900 mb-4 flex items-baseline gap-1">
                                        <span id="dailyCong" class="text-blue-600">-</span>
                                        <span class="text-base font-medium text-slate-400">công</span>
                                    </div>
                                </div>
                                <div class="space-y-3 text-sm">
                                    <div class="flex justify-between py-1 border-b border-slate-50">
                                        <span class="text-slate-500">Giờ thường</span>
                                        <span class="font-mono font-medium text-slate-700" id="dailyNormalMins">-</span>
                                    </div>
                                    <div class="flex justify-between py-1 border-b border-slate-50">
                                        <span class="text-slate-500">Giờ OT thực</span>
                                        <span class="font-mono font-medium text-slate-700" id="dailyOtRawMins">-</span>
                                    </div>
                                    <div class="flex justify-between py-1 pt-1">
                                        <span class="text-slate-500 font-medium">Tổng quy đổi</span>
                                        <span class="font-mono font-bold text-slate-900"
                                            id="dailyTotalConvertedMins">-</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Monthly Result -->
                            <div
                                class="shadcn-card p-5 flex flex-col justify-between bg-gradient-to-br from-white to-green-50/50 border-green-100 hover:border-green-300 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-0.5">
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <span
                                            class="material-symbols-outlined text-green-600 bg-green-100 p-1.5 rounded-md">calendar_month</span>
                                        <h3 class="text-sm font-semibold text-slate-700">Tổng tháng (<span
                                                id="displayDays">27</span> ngày)</h3>
                                    </div>
                                    <div
                                        class="text-3xl font-bold tracking-tight text-slate-900 mb-4 flex items-baseline gap-1">
                                        <span id="monthlyCong" class="text-green-600">-</span>
                                        <span class="text-base font-medium text-slate-400">công</span>
                                    </div>
                                </div>
                                <div class="space-y-3 text-sm">
                                    <div class="flex justify-between py-1 border-b border-green-100/50">
                                        <span class="text-slate-500">Tổng phút</span>
                                        <span class="font-mono font-medium text-slate-700" id="monthlyMins">-</span>
                                    </div>
                                    <div class="flex justify-between py-1 border-b border-green-100/50">
                                        <span class="text-slate-500">Tổng giờ</span>
                                        <span class="font-mono font-medium text-slate-700" id="monthlyHours">-</span>
                                    </div>
                                    <div class="flex justify-between py-1 pt-1">
                                        <span class="text-slate-500 font-medium">Làm tròn</span>
                                        <span class="font-mono font-bold text-slate-900"
                                            id="monthlyCongRounded">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Report Card -->
                        <div class="shadcn-card p-0 overflow-hidden flex flex-col shadow-sm">
                            <div
                                class="p-3 bg-slate-50/80 border-b border-slate-100 flex items-center justify-between backdrop-blur-sm">
                                <h3
                                    class="font-semibold text-xs md:text-sm text-slate-700 flex items-center gap-2 uppercase tracking-wide ml-1">
                                    <span class="material-symbols-outlined text-slate-400">description</span>
                                    Chi tiết báo cáo
                                </h3>
                                <div class="flex gap-2">
                                    <button onclick="exportToWord()"
                                        class="group inline-flex items-center justify-center whitespace-nowrap rounded-md text-xs font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-blue-600 text-white hover:bg-blue-700 h-8 px-3 shadow-sm active:scale-95">
                                        <span
                                            class="material-symbols-outlined text-[16px] mr-1.5 group-hover:scale-110 transition-transform">file_download</span>
                                        <span class="hidden sm:inline">Xuất báo cáo</span>
                                        <span class="sm:hidden">Xuất</span>
                                    </button>
                                    <button onclick="copyReport()"
                                        class="group inline-flex items-center justify-center whitespace-nowrap rounded-md text-xs font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-slate-900 text-white hover:bg-slate-800 h-8 px-3 shadow-sm active:scale-95">
                                        <span
                                            class="material-symbols-outlined text-[16px] mr-1.5 group-hover:scale-110 transition-transform">content_copy</span>
                                        Sao chép
                                    </button>
                                </div>
                            </div>
                            <div class="relative">
                                <textarea id="reportText" rows="8"
                                    class="w-full p-4 bg-white text-slate-600 font-mono text-xs md:text-sm resize-none focus:outline-none leading-relaxed"
                                    readonly></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 3: SALARY -->
            <div id="tab-salary" class="tab-content hidden w-full space-y-5 animate-fade-in pb-4">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-5 xl:gap-8 relative">
                    <!-- Left Column: Inputs -->
                    <div class="space-y-5">
                        <div class="shadcn-card p-5 flex flex-col h-full">
                            <h3 class="font-bold text-lg text-slate-800 mb-5">Thông tin lương</h3>

                            <div class="space-y-4 flex-1">
                                <div>
                                    <div class="flex justify-between">
                                        <label class="shadcn-label">Lương thỏa thuận (Gross)</label>
                                        <!-- <span class="material-symbols-outlined text-slate-400 text-[16px] cursor-help"
                                            title="Tổng lương thỏa thuận trong hợp đồng lao động, chưa trừ bảo hiểm và thuế">info</span> -->
                                    </div>
                                    <input type="text" id="salaryGross" value="15,000,000"
                                        class="shadcn-input save-target touch-manipulation text-right font-mono"
                                        oninput="formatCurrencyInput(this)">
                                </div>

                                <div>
                                    <div class="flex justify-between">
                                        <label class="shadcn-label">Lương đóng bảo hiểm</label>
                                        <!-- <span class="material-symbols-outlined text-slate-400 text-[16px] cursor-help"
                                            title="Mức lương làm cơ sở tính BHXH, BHYT, BHTN. Nếu để trống sẽ lấy bằng lương Gross. Trần: 20 lần lương cơ sở (46,8tr) cho BHXH/BHYT">info</span> -->
                                    </div>
                                    <input type="text" id="salaryInsurance" placeholder="Để trống nếu đóng full lương"
                                        class="shadcn-input save-target touch-manipulation text-right font-mono"
                                        oninput="formatCurrencyInput(this)">
                                </div>

                                <div>
                                    <div class="flex justify-between">
                                        <label class="shadcn-label">Số ngày công thực tế</label>
                                        <!-- <span class="material-symbols-outlined text-slate-400 text-[16px] cursor-help"
                                            title="Số ngày bạn thực sự đi làm trong tháng (không tính ngày nghỉ có lương). Thường là 22-26 ngày">info</span> -->
                                    </div>
                                    <input type="number" id="actualWorkDays" value="26"
                                        class="shadcn-input save-target touch-manipulation">
                                </div>

                                <div>
                                    <div class="flex justify-between">
                                        <label class="shadcn-label">Số ngày nghỉ hưởng lương</label>
                                        <!-- <span class="material-symbols-outlined text-slate-400 text-[16px] cursor-help"
                                            title="Các ngày nghỉ nhưng vẫn được hưởng lương: nghỉ phép năm, nghỉ lễ Tết, nghỉ ốm được duyệt... Lương tính theo công thức: (Lương BHXH / 26) x Số ngày nghỉ">info</span> -->
                                    </div>
                                    <input type="number" id="paidLeaveDays" value="0"
                                        class="shadcn-input save-target touch-manipulation">
                                </div>

                                <div>
                                    <div class="flex justify-between">
                                        <label class="shadcn-label">Số người phụ thuộc</label>
                                        <!-- <span class="material-symbols-outlined text-slate-400 text-[16px] cursor-help"
                                            title="Số người phụ thuộc đã đăng ký giảm trừ thuế (con dưới 18 tuổi, bố mẹ già, vợ/chồng không có thu nhập...). Giảm trừ 4,4 triệu/người/tháng">info</span> -->
                                    </div>
                                    <input type="number" id="dependents" value="0"
                                        class="shadcn-input save-target touch-manipulation">
                                </div>

                                <div>
                                    <div class="flex justify-between">
                                        <label class="shadcn-label">Phụ cấp & Thưởng khác</label>
                                        <!-- <span class="material-symbols-outlined text-slate-400 text-[16px] cursor-help"
                                            title="Các khoản thu nhập thêm: phụ cấp ăn trưa, xăng xe, điện thoại, thưởng hiệu suất, KPI... (các khoản tính vào lương chịu thuế)">info</span> -->
                                    </div>
                                    <input type="text" id="allowance" value="0"
                                        class="shadcn-input save-target touch-manipulation text-right font-mono"
                                        oninput="formatCurrencyInput(this)">
                                </div>

                                <div>
                                    <div class="flex justify-between">
                                        <label class="shadcn-label">Các khoản trừ khác</label>
                                        <!-- <span class="material-symbols-outlined text-slate-400 text-[16px] cursor-help"
                                            title="Các khoản bị trừ vào lương: tiền phạt, kinh phí công đoàn (nếu có), tạm ứng, khoản nợ công ty...">info</span> -->
                                    </div>
                                    <input type="text" id="otherDeductions" value="0"
                                        class="shadcn-input save-target touch-manipulation text-right font-mono"
                                        oninput="formatCurrencyInput(this)">
                                </div>
                            </div>

                            <div class="flex gap-3 pt-4 mt-auto">
                                <button onclick="resetSalaryForm()"
                                    class="flex-1 px-4 py-2 border border-slate-200 text-slate-600 rounded-lg hover:bg-slate-50 transition-colors text-sm font-medium">Hủy</button>
                                <button onclick="calculateSalary()"
                                    class="flex-1 px-4 py-2 bg-slate-900 text-white rounded-lg hover:bg-slate-800 transition-colors text-sm font-medium flex items-center justify-center gap-2">
                                    <span class="material-symbols-outlined text-[18px]">calculate</span> Tính toán
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Results -->
                    <div class="space-y-5 xl:sticky xl:top-0 xl:self-start">
                        <div class="shadcn-card p-5 sm:p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-lg text-slate-800">Bảng lương chi tiết</h3>
                                <button onclick="exportSalaryReport()"
                                    class="group inline-flex items-center justify-center whitespace-nowrap rounded-md text-xs font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-blue-600 text-white hover:bg-blue-700 h-8 px-3 shadow-sm active:scale-95">
                                    <span class="material-symbols-outlined text-[16px] mr-1.5 group-hover:scale-110 transition-transform">file_download</span>
                                    <span class="hidden sm:inline">Xuất phiếu lương</span>
                                    <span class="sm:hidden">Xuất</span>
                                </button>
                            </div>

                            <!-- Note Box -->
                            <div class="bg-blue-50 rounded-lg p-3 mb-4 border border-blue-100">
                                <h4 class="text-blue-700 font-semibold text-sm mb-1">Ghi chú về cách tính lương</h4>
                                <p class="text-[10px] text-red-500 mb-1 font-medium tracking-wide">Lưu ý: Cách tính
                                    lương này áp dụng cho Công ty Cổ phần Thương mại và Dược phẩm Ngọc Thiện</p>
                                <ul class="text-[13px] text-blue-600 space-y-0.5 list-disc pl-4">
                                    <li>Dưới 22 công: (Lương thỏa thuận / 22) × Số ngày công thực tế</li>
                                    <li>Từ 22 - 26 công: 100% Lương thỏa thuận</li>
                                    <li>Trên 26 công: (Lương thỏa thuận / 26) × Số ngày công thực tế</li>
                                    <li>Ngày nghỉ hưởng lương: (Lương đóng bảo hiểm / 26) × Số ngày nghỉ</li>
                                </ul>
                            </div>

                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between text-slate-600">
                                    <span>1. Lương theo ngày công thực tế</span>
                                    <div class="text-right">
                                        <span class="font-medium text-slate-900" id="outSalaryWork">0 ₫</span>
                                        <span class="text-[10px] text-slate-400 block" id="outWorkDays">(0 ngày)</span>
                                    </div>
                                </div>
                                <div class="flex justify-between text-slate-600">
                                    <span>2. Lương ngày nghỉ hưởng lương</span>
                                    <div class="text-right">
                                        <span class="font-medium text-slate-900" id="outSalaryLeave">0 ₫</span>
                                        <span class="text-[10px] text-slate-400 block" id="outLeaveDays">(0 ngày)</span>
                                    </div>
                                </div>
                                <div class="flex justify-between text-slate-600">
                                    <span>3. Phụ cấp & Thưởng khác</span>
                                    <span class="font-medium text-slate-900" id="outAllowance">+ 0 ₫</span>
                                </div>

                                <div class="pt-3 border-t border-slate-100 flex justify-between items-center">
                                    <span class="font-bold text-slate-800">A. Tổng thu nhập (Gross)</span>
                                    <span class="font-bold text-slate-900 text-sm" id="outGrossTotal">0 ₫</span>
                                </div>

                                <div class="pt-1">
                                    <span class="font-bold text-slate-800 block mb-1">B. Các khoản khấu trừ</span>
                                    <div class="pl-4 space-y-1 border-l-2 border-slate-100">
                                        <div class="flex justify-between text-slate-600">
                                            <span>1. Bảo hiểm xã hội (8%)</span>
                                            <span class="font-medium text-slate-900" id="outBHXH">- 0 ₫</span>
                                        </div>
                                        <div class="flex justify-between text-slate-600">
                                            <span>2. Bảo hiểm y tế (1.5%)</span>
                                            <span class="font-medium text-slate-900" id="outBHYT">- 0 ₫</span>
                                        </div>
                                        <div class="flex justify-between text-slate-600">
                                            <span>3. Bảo hiểm thất nghiệp (1%)</span>
                                            <span class="font-medium text-slate-900" id="outBHTN">- 0 ₫</span>
                                        </div>
                                        <div class="flex justify-between text-slate-600">
                                            <span>4. Các khoản trừ khác</span>
                                            <span class="font-medium text-slate-900" id="outOtherDeductions">- 0
                                                ₫</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex justify-between items-center pt-1 text-red-600 font-medium">
                                    <span>Tổng khấu trừ</span>
                                    <span id="outTotalDeductions">0 ₫</span>
                                </div>

                                <div class="my-3 border-t border-dashed border-slate-200"></div>

                                <div class="flex justify-between items-end">
                                    <span class="font-bold text-base text-slate-800">Lương thực nhận (NET)</span>
                                    <span class="font-bold text-lg text-green-600" id="outNetSalary">0 ₫</span>
                                </div>

                                <div
                                    class="flex justify-between items-center pt-3 border-t border-slate-100 text-slate-500 text-[10px]">
                                    <span>Thuế TNCN (Ước tính)</span>
                                    <span class="font-medium text-slate-700" id="outPIT">0 ₫</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 4: TAX CALCULATOR -->
            <div id="tab-tax" class="tab-content hidden w-full space-y-5 animate-fade-in pb-4">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-5 xl:gap-8 relative">
                    <!-- Left Column: Inputs -->
                    <div class="space-y-5">
                        <div class="shadcn-card p-5 flex flex-col h-full">
                            <div class="flex justify-between items-center mb-5">
                                <h3 class="font-bold text-lg text-slate-800">Thông tin thu nhập</h3>
                                <button onclick="exportTaxReport()" 
                                    class="flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 text-white hover:bg-blue-700 text-sm font-medium rounded-lg transition-colors shadow-sm">
                                    <span class="material-symbols-outlined text-[18px]">file_download</span>
                                    <span class="hidden sm:inline">Xuất thông tin thuế TNCN</span>
                                </button>
                            </div>

                            <div class="space-y-4 flex-1">
                                <div>
                                    <div class="flex justify-between">
                                        <label class="shadcn-label">Thu nhập tháng (Gross)</label>
                                        <!-- <span class="material-symbols-outlined text-slate-400 text-[16px] cursor-help"
                                            title="Tổng thu nhập chịu thuế TNCN trong tháng, bao gồm lương cơ bản + phụ cấp + thưởng (trước khi trừ bảo hiểm)">info</span> -->
                                    </div>
                                    <input type="text" id="taxGross" value="20,000,000"
                                        class="shadcn-input save-target touch-manipulation text-right font-mono"
                                        oninput="formatCurrencyInput(this); calculateTax()">
                                </div>

                                <div>
                                    <div class="flex justify-between">
                                        <label class="shadcn-label">Lương đóng bảo hiểm</label>
                                        <!-- <span class="material-symbols-outlined text-slate-400 text-[16px] cursor-help"
                                            title="Mức lương làm cơ sở tính BHXH, BHYT, BHTN. Nếu để trống sẽ lấy bằng lương Gross. Trần: 20 lần lương cơ sở (46,8tr) cho BHXH/BHYT">info</span> -->
                                    </div>
                                    <input type="text" id="taxInsuranceSalary" placeholder="Mặc định bằng lương Gross"
                                        class="shadcn-input save-target touch-manipulation text-right font-mono"
                                        oninput="formatCurrencyInput(this); calculateTax()">
                                </div>

                                <div>
                                    <div class="flex justify-between">
                                        <label class="shadcn-label">Số người phụ thuộc</label>
                                        <!-- <span class="material-symbols-outlined text-slate-400 text-[16px] cursor-help"
                                            title="Số người phụ thuộc được giảm trừ theo Nghị Quyết 954/2020: 4,4 triệu/người/tháng. Bao gồm: con dưới 18 tuổi, cha mẹ già, vợ/chồng không có thu nhập">info</span> -->
                                    </div>
                                    <input type="number" id="taxDependents" value="0" min="0"
                                        class="shadcn-input save-target touch-manipulation" oninput="calculateTax()">
                                </div>

                                <div>
                                    <label class="shadcn-label">Vùng (Lương tối thiểu)</label>
                                    <input type="hidden" id="taxRegion" value="1" class="save-target" onchange="calculateTax()">
                                    
                                    <div class="relative">
                                        <button type="button" onclick="toggleRegionDropdown(event)" id="regionDropdownBtn"
                                            class="shadcn-input w-full text-left flex items-center justify-between bg-white cursor-pointer hover:border-blue-400 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-100 focus:border-blue-400">
                                            <span id="regionSelectedText" class="truncate text-sm">Vùng I (4.960.000đ)</span>
                                            <span class="material-symbols-outlined text-slate-400 text-[20px] transition-transform duration-200" id="regionDropdownArrow">expand_more</span>
                                        </button>

                                        <div id="regionDropdownMenu" 
                                            class="hidden absolute z-50 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-xl max-h-60 overflow-y-auto animate-in fade-in zoom-in-95 duration-100 origin-top-left">
                                            <div class="p-1 space-y-0.5">
                                                <div onclick="selectRegion(1, 'Vùng I (4.960.000đ)')" 
                                                    class="region-option flex items-center justify-between px-3 py-2.5 text-sm text-slate-700 rounded-md hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors" data-value="1">
                                                    <span>Vùng I (4.960.000đ)</span>
                                                    <span class="material-symbols-outlined text-[18px] text-blue-600 opacity-0 check-icon">check</span>
                                                </div>
                                                <div onclick="selectRegion(2, 'Vùng II (4.410.000đ)')" 
                                                    class="region-option flex items-center justify-between px-3 py-2.5 text-sm text-slate-700 rounded-md hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors" data-value="2">
                                                    <span>Vùng II (4.410.000đ)</span>
                                                    <span class="material-symbols-outlined text-[18px] text-blue-600 opacity-0 check-icon">check</span>
                                                </div>
                                                <div onclick="selectRegion(3, 'Vùng III (3.860.000đ)')" 
                                                    class="region-option flex items-center justify-between px-3 py-2.5 text-sm text-slate-700 rounded-md hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors" data-value="3">
                                                    <span>Vùng III (3.860.000đ)</span>
                                                    <span class="material-symbols-outlined text-[18px] text-blue-600 opacity-0 check-icon">check</span>
                                                </div>
                                                <div onclick="selectRegion(4, 'Vùng IV (3.450.000đ)')" 
                                                    class="region-option flex items-center justify-between px-3 py-2.5 text-sm text-slate-700 rounded-md hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors" data-value="4">
                                                    <span>Vùng IV (3.450.000đ)</span>
                                                    <span class="material-symbols-outlined text-[18px] text-blue-600 opacity-0 check-icon">check</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="text-[10px] text-slate-400 mt-1">Dùng để tính trần BHTN (20 lần Lương tối thiểu vùng)</p>
                                </div>

                                <div class="pt-2">
                                    <label class="shadcn-label mb-2">Cấu hình bảo hiểm</label>
                                    <div class="flex flex-wrap gap-3 sm:gap-4 mt-5">
                                        <div class="flex items-center gap-2">
                                            <input id="checkBHXH" type="checkbox" checked onchange="calculateTax()" class="custom-checkbox">
                                            <label for="checkBHXH" class="select-none text-sm font-medium text-slate-700 cursor-pointer whitespace-nowrap">BHXH (8%)</label>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input id="checkBHYT" type="checkbox" checked onchange="calculateTax()" class="custom-checkbox">
                                            <label for="checkBHYT" class="select-none text-sm font-medium text-slate-700 cursor-pointer whitespace-nowrap">BHYT (1.5%)</label>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input id="checkBHTN" type="checkbox" checked onchange="calculateTax()" class="custom-checkbox">
                                            <label for="checkBHTN" class="select-none text-sm font-medium text-slate-700 cursor-pointer whitespace-nowrap">BHTN (1%)</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Results -->
                    <div class="space-y-5 xl:sticky xl:top-0 xl:self-start">
                        <div class="shadcn-card p-0 overflow-hidden">
                            <!-- Main Result Table -->
                            <div class="bg-slate-100/50 p-4 border-b border-slate-200">
                                <div class="space-y-0 text-sm">
                                    <div class="flex justify-between items-center py-2 px-2 bg-slate-200/50 rounded font-bold text-slate-800 mb-1">
                                        <span>Lương GROSS</span>
                                        <span id="resTaxGross">0</span>
                                    </div>
                                    
                                    <div class="flex justify-between items-center py-2 px-2 border-b border-slate-100">
                                        <span class="text-slate-600 font-medium">Bảo hiểm xã hội (8%)</span>
                                        <span class="text-slate-800" id="resTaxBHXH">0</span>
                                    </div>
                                    <div class="flex justify-between items-center py-2 px-2 border-b border-slate-100">
                                        <span class="text-slate-600 font-medium">Bảo hiểm y tế (1.5%)</span>
                                        <span class="text-slate-800" id="resTaxBHYT">0</span>
                                    </div>
                                    <div class="flex justify-between items-center py-2 px-2 border-b border-slate-100">
                                        <span class="text-slate-600 font-medium">Bảo hiểm thất nghiệp (1%)</span>
                                        <span class="text-slate-800" id="resTaxBHTN">0</span>
                                    </div>

                                    <div class="flex justify-between items-center py-2 px-2 bg-slate-200/50 rounded font-bold text-slate-800 my-1">
                                        <span>Thu nhập trước thuế</span>
                                        <span id="resTaxTNTT">0</span>
                                    </div>

                                    <div class="flex justify-between items-center py-2 px-2 border-b border-slate-100">
                                        <span class="text-slate-600 font-medium">Giảm trừ gia cảnh bản thân</span>
                                        <span class="text-slate-800" id="resTaxSelfDeduction">11,000,000</span>
                                    </div>
                                    <div class="flex justify-between items-center py-2 px-2 border-b border-slate-100">
                                        <span class="text-slate-600 font-medium">Giảm trừ gia cảnh người phụ thuộc</span>
                                        <span class="text-slate-800" id="resTaxDependentDeduction">0</span>
                                    </div>

                                    <div class="flex justify-between items-center py-2 px-2 bg-slate-200/50 rounded font-bold text-slate-800 my-1">
                                        <span>Thu nhập chịu thuế</span>
                                        <span id="resTaxTNCT">0</span>
                                    </div>

                                    <div class="flex justify-between items-center py-2 px-2 bg-white rounded border border-slate-200 font-bold text-slate-800">
                                        <span>Thuế thu nhập cá nhân(*)</span>
                                        <span id="resTaxValue">0</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Detailed Breakdown Table -->
                            <div class="p-4 bg-white">
                                <h4 class="text-green-600 font-bold text-sm mb-3">(*) Chi tiết thuế thu nhập cá nhân (VNĐ)</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm text-left">
                                        <thead class="bg-slate-100 text-slate-700 font-semibold">
                                            <tr>
                                                <th class="py-2 px-3 text-right w-1/2">Mức chịu thuế</th>
                                                <th class="py-2 px-3 text-center w-1/4">Thuế suất</th>
                                                <th class="py-2 px-3 text-right w-1/4">Tiền nộp</th>
                                            </tr>
                                        </thead>
                                        <tbody id="taxDetailBody" class="divide-y divide-slate-100">
                                            <!-- Rows will be populated by JS -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <footer class="py-2 text-center text-xs text-slate-400 border-t border-slate-100/50">
            <div class="text-xs text-slate-500 mt-2">
                Designed and developed by Nguyen The Hoang
            </div>
        </footer>
    </div>

    <script src="script.js"></script>
</body>

</html>